// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // Transaction Mode (Port 6543) - Uygulama burayı kullanır
  directUrl = env("DIRECT_URL")    // Session Mode (Port 5432) - Migration burayı kullanır
}

model Ticker {
  symbol    String   @id
  name      String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  news NewsEvent[]
}

model NewsEvent {
  id           String   @id @default(uuid())
  tickerSymbol String
  headline     String
  url          String?
  type         String?  // Earnings, Analyst vb.
  publishedAt  DateTime
  
  // Finnhub'dan gelen raw ID veya hash
  externalId   String?  @unique 

  // İlişki
  ticker       Ticker   @relation(fields: [tickerSymbol], references: [symbol])
  score        NewsScore?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([tickerSymbol])
  @@index([publishedAt])
}

model NewsScore {
  id           String    @id @default(uuid())
  newsEventId  String    @unique
  
  score        Int       // 0-100 arası
  pricedIn     Boolean   @default(false)
  
  retPre5      Float?
  ret1d        Float?
  ret5d        Float?
  
  calculatedAt DateTime  @default(now())

  // İlişki
  newsEvent    NewsEvent @relation(fields: [newsEventId], references: [id], onDelete: Cascade)
}
